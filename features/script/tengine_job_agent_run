#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

paths = IO.popen("which -a tengine_job_agent_run")
realpath = nil
while path = paths.gets do
  realpath = path
end
realpath.chomp!

ssh_kill_before, ssh_kill_after
before_execute_sleep_time, after_exexute_sleep_time = 0, 0

ssh_kill_before = ENV["SSH_KILL_BEFORE"] == "true" if ENV["SSH_KILL_BEFORE"]

ssh_kill_after = ENV["SSH_KILL_AFTER"] == "true" if ENV["SSH_KILL_AFTER"]

before_execute_sleep_time = ENV["BEFORE_EXECUTE_SLEEP_TIME"].to_i if ENV["BEFORE_EXECUTE_SLEEP_TIME"]

after_exexute_sleep_time = ENV["AFTER_EXECUTE_SLEEP_TIME"].to_i if ENV["AFTER_EXECUTE_SLEEP_TIME"]

puts before_execute_sleep_time
sleep  before_execute_sleep_time
system("#{realpath}  #{ARGV.join(" ")}")
exit_code = $?.exitstatus
sleep after_exexute_sleep_time
exit(exit_code)
