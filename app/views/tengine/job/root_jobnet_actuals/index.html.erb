<h1><%= page_title Tengine::Job::RootJobnetActual, :list %></h1>

<div class="TreeViewContents">
  <div class="DataView">
    <div class="Wrap">
      <% if @finder.errors.any? %>
        <div class="Msg MsgError">
          <p><%= t(".finder.error_caption", :count => @finder.errors.size) %></p>
          <ul>
          <% @finder.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
          </ul>
        </div>
      <% end %>

      <div class="search-box">
        <%= form_for(:finder, :html => {:method => :get}) do |f| %>
        <fieldset>
          <legend><%= t("views.pages.search_caption") %></legend>
          <table>
            <tr>
              <th><%= f.label :duration %></th>
              <td>
                <%= f.select :duration, [
                  [Tengine::Job::RootJobnetActual.human_attribute_name(:started_at), :started_at],
                  [Tengine::Job::RootJobnetActual.human_attribute_name(:finished_at), :finished_at]] %>
              </td>
            </tr>
            <tr>
              <th></th>
              <td>
                <%= f.datetime_select :duration_start %> -
                <%= f.datetime_select :duration_finish %>
              </td>
            </tr>
            <tr>
              <th><%= f.label :id %></th>
              <td><%= f.text_field :id %></td>
            </tr>
            <tr>
              <th><%= f.label :name %></th>
              <td><%= f.text_field :name %></td>
            </tr>
            <tr>
              <th><%= f.label :phase_cd %></th>
              <td><%= f.check_box_group :phase_cd %></td>
            </tr>
            <tr>
              <th><%= f.label :reflesh_interval %></th>
              <td>
                <%= f.text_field :reflesh_interval %>
                <br />
                <span class="TextNotice"><%= t("views.caution.reflesh_interval") %></span>
              </td>
            </tr>
          </table>
         <% if @category -%>
           <%= hidden_field_tag :category, @category.id %>
         <% end -%>
  
          <div class="align-right">
            <%= f.submit(t("views.links.search")) %>
            <%= tag :input, { "type" => "reset", "name" => "reset", "value" => t("views.links.reset") } %>
          </div>
        </fieldset>
        <% end %>
      </div>

      <%= paginate @root_jobnet_actuals, :items => @root_jobnet_actuals %>

      <table class="TableBase">
        <colgroup>
          <col class="Row1">
          <col class="Row2">
          <col class="Row3">
          <col class="Row4">
          <col class="Row5">
          <col class="Row6">
          <col class="Row7 RowAction">
        </colgroup>
        <thead>
          <tr>
            <% query_without_page = request.query_parameters.select{|k,v| %w(category finder).include?(k.to_s) } -%>
            <th scope="col"><%= link_to(Tengine::Job::RootJobnetActual.human_attribute_name(:id), tengine_job_root_jobnet_actuals_path(query_without_page.merge(sort_param(:id))), :class => sort_class(:id)) %></th>
            <th scope="col"><%= link_to(Tengine::Job::RootJobnetActual.human_attribute_name(:name), tengine_job_root_jobnet_actuals_path(query_without_page.merge(sort_param(:name))), :class => sort_class(:name)) %></th>
            <th scope="col"><%= link_to(Tengine::Job::RootJobnetActual.human_attribute_name(:description), tengine_job_root_jobnet_actuals_path(query_without_page.merge(sort_param(:description))), :class => sort_class(:description)) %></th>
            <th scope="col"><%= link_to(Tengine::Job::RootJobnetActual.human_attribute_name(:phase_cd), tengine_job_root_jobnet_actuals_path(query_without_page.merge(sort_param(:phase_cd))), :class => sort_class(:phase_cd)) %></th>
            <th scope="col"><%= link_to(Tengine::Job::RootJobnetActual.human_attribute_name(:started_at), tengine_job_root_jobnet_actuals_path(query_without_page.merge(sort_param(:started_at))), :class => sort_class(:started_at)) %></th>
            <th scope="col"><%= link_to(Tengine::Job::RootJobnetActual.human_attribute_name(:finished_at), tengine_job_root_jobnet_actuals_path(query_without_page.merge(sort_param(:finished_at))), :class => sort_class(:finished_at)) %></th>
            <th scope="col"><%= t("views.pages.operation") %></th>
          </tr>
        </thead>

        <tbody>
        <% @root_jobnet_actuals.each do |root_jobnet_actual| %>
          <tr class="<%= cycle("even", "odd") %>" >
            <td><%= root_jobnet_actual.id %></td>
            <td><%= root_jobnet_actual.name %></td>
            <td><%= root_jobnet_actual.description %></td>
            <td><%= root_jobnet_actual.phase_name %></td>
            <td><%= root_jobnet_actual.started_at.to_s %></td>
            <td><%= root_jobnet_actual.finished_at %></td>
            <td>
              <%= link_to(t("views.links.watch"), root_jobnet_actual) %>
              <% if %w(initialized success error stuck).include?(root_jobnet_actual.phase_key.to_s) -%>
                <%= link_to(t("views.links.rerun"), new_tengine_job_execution_path(:root_jobnet_id => root_jobnet_actual, :retry => true)) %>
              <% end -%>
              <% if %w(running).include?(root_jobnet_actual.phase_key.to_s) -%>
                <%= link_to(t("views.links.force_exit"), root_jobnet_actual, confirm: t(".confirm.destroy"), method: :delete ) %>
              <% end -%>
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
        
      <%= paginate @root_jobnet_actuals, :items => @root_jobnet_actuals %>
  
    </div>
  </div>

  <div class="TreeView">
    <% params_without_page_and_sort = request.params.select{|k,v| %w(finder).include?(k.to_s) } -%>
    <%== category_tree(@root_categories, "category", params_without_page_and_sort) %>
  </div>
</div>
