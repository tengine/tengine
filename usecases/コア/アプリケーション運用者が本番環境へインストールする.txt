ユースケース名:
  アプリケーション運用者が本番環境へインストールする

背景:
  アプリケーション開発者が作成したイベントハンドラ定義を実運用するために、Tengineを本番環境にインストールする

概要:
  アプリケーション運用者がTengineを動かすためのパッケージとTengineコアとTengineコンソールのインストールおよびセットアップを行った後、
  Tengineコアが提供するテスト起動を使用することでTengineコアが正常に動作するための準備が完了したことを確認する

  アプリケーション運用者がインストールおよびセットアップを行う中で問題が発生した場合、ドキュメントを参考に問題の解決を試みるが、
  それでも解決しない場合はTengineのサポート窓口やTengineユーザグループへ問い合わせを行う
  なお、問い合わせを行う際には、問題が発生したサーバにインストールされているパッケージとサーバの構成情報を添える。
  Tengineでは、これをサポートする「サーバ構成レポート収集ツール」を提供する

事前条件:
  イベントハンドラ定義を配置する任意のストレージ、SCM、DB、キュー、Tengineコア、Tengineコンソールを使用およびインストールする対象となる全てのサーバが以下の条件を満たしている
    * ハードウェアの準備（電源接続、ケーブル配線、システムBIOS初期設定、ファームウェアのアップデート）が完了している
    * OSのインストールが完了している
    * ネットワークの接続が完了している

成功時保証:
  TengineコンソールサーバでTengineコンソールが停止していること
  全てのTengineコアサーバでTengineコアが停止していること
  キューサーバでキューのプロセスが停止していること
  DBサーバでDBのプロセスが停止していること

最低保証:
  なし

登場するパッケージ:
  SCM
  DB
  キュー
  Tengineコア
  Tengineコンソール

登場するコンポーネント:
  テスト起動コマンド
  イベント管理画面

参照するドキュメント:
  運用者向けTengineマニュアル


基本コース:
1. アプリケーション運用者がイベントハンドラ定義のデプロイ先として任意のディレクトリを利用できるようにする
2. アプリケーション運用者がイベントハンドラ定義ストアとして任意のストレージを利用できるようにする [代替コースA, 代替コースB]

3. アプリケーション運用者がDBサーバにDBのインストールを行う <戻り点: DBインストール>
4. アプリケーション運用者がDBサーバでDBのプロセスを起動する
5. アプリケーション運用者がDBサーバでDBのプロセスが起動していることを確認する
6. アプリケーション運用者が必要に応じてDBサーバでDBの冗長化の設定を行う
7. アプリケーション運用者が必要に応じてDBサーバでDBの分割データ配置(シャーディング)の設定を行う
8. アプリケーション運用者が必要に応じてDBサーバでDBの自動バックアップの設定を行う
9. アプリケーション運用者がDBサーバでDBの設定が反映されていることを確認する

10. アプリケーション運用者がキューサーバにキューのインストールを行う [代替コースC]
11. アプリケーション運用者がキューサーバでキューのプロセスの起動を行う <戻り点: キュープロセス起動>
12. アプリケーション運用者がキューサーバでキューのプロセスの起動を確認する
13. アプリケーション運用者が必要に応じてキューサーバでキューの冗長化の設定を行う
14. アプリケーション運用者がキューサーバでキューの設定が反映されていることを確認する

15. アプリケーション運用者がコアサーバにTengineコアのインストールを行う [代替コースD]
16. アプリケーション運用者がコアサーバでTengineコアのセットアップを行う [代替コースE]
17. アプリケーション運用者がコアサーバでテスト起動を行う [代替コースF] <戻り点: テスト起動>
18. アプリケーション運用者がコアサーバでテスト起動が成功することを確認する <戻り点: テスト起動の成功確認>
19. アプリケーション運用者がコアサーバでTengineコアのプロセスを起動する [代替コースG]
20. アプリケーション運用者がコアサーバでTengineコアのプロセスを起動を確認する <戻り点: Tengineコアプロセスの起動確認>

21. アプリケーション運用者がTengineコンソールサーバにTengineコンソールのインストールを行う [代替コースH]
22. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのプロセスを起動する [代替コースI]
23. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのプロセスが起動していることを確認する <戻り点: Tengineコンソールプロセスの起動確認>
24. アプリケーション運用者がTengineコンソールの「イベント管理画面」が表示できることを確認する

25. アプリケーション運用者がTengineコンソールサーバでTengineコンソールをコマンドで停止する
26. アプリケーション運用者がTengineコンソールサーバでTengineコンソールが停止していることを確認する
27. アプリケーション運用者が全てのTengineコアサーバでTengineコアをコマンドで停止する
28. アプリケーション運用者がTengineコアサーバでTengineコアが停止していることを確認する
29. アプリケーション運用者がキューサーバでキューのプロセスをコマンドで停止する
30. アプリケーション運用者がキューサーバでキューのプロセスが停止していることを確認する
31. アプリケーション運用者がDBサーバでDBのプロセスをコマンドで停止する
32. アプリケーション運用者がDBサーバでDBのプロセスが停止していることを確認する


代替コースA: イベントハンドラ定義ストアとしてSCMを利用する
1. アプリケーション運用者がSCMサーバにSCMをインストールする
2. アプリケーション運用者がイベントハンドラ定義ストアとしてSCMを利用できるようにする
3. <戻り点: DBインストール>に遷移する


代替コースB: イベントハンドラ定義ストアとして外部のSCMサービスを利用する
1. アプリケーション運用者が外部のSCMサービスにサインアップする
2. アプリケーション運用者が外部のSCMサービスにログインする
3. アプリケーション運用者がイベントハンドラ定義ストアとして外部のSCMサービスを利用できるようにする
4. <戻り点: DBインストール>に遷移する


代替コースC: 運用中に当初想定を大きく上回るメッセージのデータ量が発生した場合に備え、動的にパーティションの容量を変更するために、キューの格納領域をLVMで設定する
1. アプリケーション運用者がキューサーバでLVMの設定を行う
2. アプリケーション運用者がキューサーバにキューのインストールを行う
3. <戻り点: キュープロセス起動>に遷移する


代替コースD: Tengineコアのインストールに失敗する
1. アプリケーション運用者がコアサーバでTengineコアのインストールに失敗する
2. アプリケーション運用者がコアサーバでTengineコアのインストール時の出力結果を確認する
3. アプリケーション運用者がコアサーバでTengineコアのインストール時の出力結果を元に問題を取り除く [代替コースY, 代替コースZ]
4. アプリケーション運用者がコアサーバでTengineコアのインストールを行う
5. <戻り点: Tengineコアプロセスの起動>に遷移する


代替コースE: 複数のTengineコアのセットアップを行う
1. アプリケーション運用者が1台のコアサーバでTengineコアのセットアップを行う
2. アプリケーション運用者がセットアップ済のコアサーバで動的に変更される設定ファイルを複数のTengineコアへ配布する
3. <戻り点: テスト起動>に遷移する


代替コースF: テスト起動に失敗する
1. アプリケーション運用者がコアサーバでテスト起動に失敗する
2. アプリケーション運用者がコアサーバでTengineコアのログを確認する
3. アプリケーション運用者がコアサーバのTengineコアのログを元に問題を取り除く [代替コースY, 代替コースZ]
4. アプリケーション運用者がコアサーバでテスト起動を行う
5. <戻り点: テスト起動の成功確認>に遷移する


代替コースG: Tengineコアのプロセスの起動に失敗する
1. アプリケーション運用者がコアサーバでTengineコアのプロセスの起動に失敗する
2. アプリケーション運用者がコアサーバでTengineコアのプロセス起動時の出力結果を確認する
3. アプリケーション運用者がコアサーバでTengineコアのプロセス起動時の出力結果を元に問題を取り除く [代替コースY, 代替コースZ]
4. アプリケーション運用者がコアサーバでTengineコアのプロセスを起動する
5. <戻り点: Tengineコアプロセスの起動確認>に遷移する


代替コースH: Tengineコンソールのインストールに失敗する
1. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのインストールに失敗する
2. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのインストール時の出力結果を確認する
3. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのインストール時の出力結果を元に問題を取り除く [代替コースY, 代替コースZ]
4. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのインストールを行う
5. <戻り点: Tengineコンソールプロセスの起動>に遷移する


代替コースI: Tengineコンソールのプロセスの起動に失敗する
1. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのプロセスの起動に失敗する
2. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのプロセス起動時の出力結果を確認する
3. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのプロセス起動時の出力結果を元に問題を取り除く [代替コースY, 代替コースZ]
4. アプリケーション運用者がTengineコンソールサーバでTengineコンソールのプロセスを起動する
5. <戻り点: Tengineコンソールプロセスの起動確認>に遷移する


代替コースY: Tengineサポート窓口へ問い合わせる
1. アプリケーション運用者がサーバ構成レポート収集ツールでサーバ構成の内容を収集する
2. アプリケーション運用者がTengineサポート窓口へ問い合わせる
3. ユースケースは終了する


代替コースZ: Tengineユーザグループへ問い合わせる
1. アプリケーション運用者がサーバ構成レポート収集ツールでサーバ構成の内容を収集する
2. アプリケーション運用者がTengineユーザグループへ問い合わせる
3. ユースケースは終了する


注記:
  なし
