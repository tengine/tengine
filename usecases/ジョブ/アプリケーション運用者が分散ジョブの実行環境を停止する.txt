ユースケース名:
  アプリケーション運用者が分散ジョブの実行環境を停止する

背景:
  分散バッチを実行したあと、使用しなくなった仮想サーバは速やかにシャットダウンする必要がある。
  その際、仮想サーバ上に配置されたログファイル等を退避させる必要がある。
  このユースケースでは、分散バッチで出力されたログファイルを退避させ、仮想サーバを安全に
  シャットダウンするところまでを扱う。

概要:
  アプリケーション運用者は、分散バッチを実行した後、分散バッチ環境バックアップ用のジョブネットを
  起動することによって、仮想サーバー上にあるログファイルなどを退避させる。
  その後、[サーバ一覧画面]で仮想サーバを確認した上で、停止する仮想サーバをTengineに指示する。
  Tengineは仮想サーバ基盤にその内容を指示して、仮想サーバ基盤は仮想サーバの停止を行う。

事前条件:
  分散バッチの実行が完了している

成功時保証:
  アプリケーション運用者が分散バッチのログファイル等が退避できていることを確認できる
  アプリケーション運用者が分散バッチで使用した仮想マシンがシャットダウンできていることを確認できる

最低保証:
  なし

登場する画面:
  サーバ一覧画面
  仮想サーバ停止画面
  ジョブネット一覧
  実行スケジュール登録画面
  実行スケジュール確認画面

登場するコンポーネント:
  分散バッチ環境バックアップ用のジョブネット  ## いつ誰が登録するのか？

登場するパッケージ:

登場するドキュメント:

基本コース:
 1. アプリケーション運用者は「ジョブネット一覧」を開く
 2. 「ジョブネット一覧」は登録されているジョブネットの一覧を表示する
 3. アプリケーション運用者は「ジョブネット一覧」で「分散バッチ環境バックアップ用のジョブネット」に対して実行スケジュールの登録を行うために「実行スケジュール登録画面」へのリンクを選択する
 4. アプリケーション運用者は「実行スケジュール登録画面」で「分散バッチ環境バックアップ用のジョブネット」の実行を指示する
 5. 「実行スケジュール登録画面」はTengineコアに「分散バッチ環境バックアップ用のジョブネット」の実行を依頼する実行スケジュール起動イベントを発火する
 6. Tengineコアは「実行スケジュール起動イベント」を受信してそのイベントハンドラを実行する
 7. 「実行スケジュール起動イベント」のイベントハンドラは「分散バッチ環境バックアップ用のジョブネット」を実行するサーバにSSHで接続を行う
 8. 「実行スケジュール起動イベント」のイベントハンドラは「分散バッチ環境バックアップ用のジョブネット」を実行するシェルスクリプトを実行する
 9. 「分散バッチ環境バックアップ用のジョブネット」を実行するシェルスクリプトは分散バッチ環境のバックアップを行う
10. 「分散バッチ環境バックアップ用のジョブネット」を実行するシェルスクリプトはシェルスクリプトの実行が終了したことを「実行スケジュール起動イベント」のイベントハンドラに伝える
11. Tengineコアは「実行スケジュール起動イベント」のイベントハンドラの処理を終了する
12. アプリケーション運用者は「実行スケジュール確認画面」を開く
13. 「実行スケジュール確認画面」は「分散バッチ環境バックアップ用のジョブネット」の実行が終了したことを出力する
14. アプリケーション運用者は「分散バッチ環境バックアップ用のジョブネット」の実行が終了したことを「実行スケジュール確認画面」で確認する

15. アプリケーション運用者は「サーバ一覧画面」を開く
16. 「サーバ一覧画面」は仮想サーバ基盤に物理サーバ、仮想サーバの情報を問い合わせる
17. 仮想サーバ基盤は管理下の物理サーバ、仮想サーバの情報を答える
18. 「サーバ一覧画面」は物理サーバ上でどの仮想サーバが動いているのかを出力する
19. アプリケーション運用者は「サーバ一覧画面」を確認して、どの仮想サーバを停止するのかを決める
20. アプリケーション運用者は「仮想サーバ停止画面」を開き、どの仮想サーバを停止するのかを指示する
21. 「仮想サーバ停止画面」は仮想サーバ基盤にどの仮想サーバを停止するのかを指示する
22. 仮想サーバ基盤は仮想サーバの停止を始めて、要求のあった仮想サーバ群の状態を「仮想サーバ停止画面」に報告する
23. 「仮想サーバ停止画面」は要求のあった仮想サーバ群の状態を出力する
24. アプリケーション運用者は指示した通りの停止が行われているのかを「サーバ一覧画面」を開いて確認する
