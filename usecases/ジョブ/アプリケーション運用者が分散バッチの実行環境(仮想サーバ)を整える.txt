ユースケース名:
  アプリケーション運用者が分散ジョブの実行環境(仮想サーバ)を整える

背景:
  分散バッチを実行するにはその実行環境をセットアップする必要がある。
  実行環境のセットアップは、構成するサーバを起動し設定を行う作業と、
  起動したサーバ上で実行する分散バッチをデプロイする作業の２つの作業に
  分けられる。このユースケースでは前者を扱う。

  構成する仮想サーバを起動し設定を行うに当たって、どの物理サーバ上で起動するのかを
  設定できなければならない。これは、例えばHadoopクラスタが動作する仮想サーバ群が
  ネットワーク的に離れた物理サーバ上で動作すると、ネットワーク的に近い場合に比べて
  余計に通信コストがかかってしまうためである。これを解決するために、仮想サーバを起動
  する際に物理サーバ（あるいは同じ物理サーバ）で仮想サーバを起動できるように指定する
  機能が必要である。

概要:
  アプリケーション運用者は、[サーバ一覧画面]で物理サーバとその上で起動している仮想サーバを確認した上で、
  物理サーバと起動する仮想サーバのイメージと台数を指定して起動をTengineに指示する。
  Tengineはサーバ仮想基盤にその指示の内容をサーバ仮想基盤に指示して、サーバ仮想基盤は仮想サーバを起動を開始する。
  仮想サーバがすべて起動した後、実行環境構築用のジョブネットを起動することによって、実行環境のセットアップを行う。

事前条件:
  Tengineがセットアップされている。
  Trngineと連携するサーバ仮想基盤がセットアップされている。
  制御対象の物理サーバが起動している。

成功時保証:
  アプリケーション運用者が

最低保証:
  なし

登場する画面:
  サーバ一覧画面
  仮想サーバ起動画面
  ジョブネット一覧
  実行スケジュール登録画面

登場するコンポーネント:
  実行環境構築用のジョブネット  ##### これはいつ誰が登録するのか？

登場するパッケージ:

登場するドキュメント:

基本コース:
 1. アプリケーション運用者は「サーバ一覧画面」を開く
 2. 「サーバ一覧画面」はサーバ仮想基盤に物理サーバ、仮想サーバの情報を問い合わせる
 3. サーバ仮想基盤は管理下の物理サーバ、仮想サーバの情報を答える
 4. 「サーバ一覧画面」は物理サーバ上でどの仮想サーバが動いているのかを出力する
 5. アプリケーション運用者は「サーバ一覧画面」を確認して、どの物理サーバでどのイメージの仮想サーバを何台起動するのかを決める
 6. アプリケーション運用者は「仮想サーバ起動画面」を開き、どの物理サーバでどのイメージの仮想サーバを何台起動するのかを指示する
 7. 「仮想サーバ起動画面」はサーバ仮想基盤にどの物理サーバでどのイメージの仮想サーバを何台起動するのかを指示する
 8. サーバ仮想基盤は仮想サーバの起動を始めて、要求のあった仮想サーバ群の状態を、「仮想サーバ起動画面」に報告する
 9. 「仮想サーバ起動画面」は要求のあった仮想サーバ群の状態を出力する
10. アプリケーション運用者は指示した通りの起動が行われているのかを「サーバ一覧画面」を開いて確認する。

# ここ必要か？できれば仮想サーバの起動時に指定したい。複数ある場合は連番を振るとか。
11. アプリケーション運用者は仮想サーバの識別子を、ジョブDSLで使用されている名前に変更する。

12. アプリケーション運用者は、すべての仮想サーバが起動し終えるの待つ

13. アプリケーション運用者は「ジョブネット一覧」を開く
14. 「ジョブネット一覧」は登録されているジョブネットの一覧を表示する
15. アプリケーション運用者は「ジョブネット一覧」で「実行環境構築用のジョブネット」に対して実行スケジュールの登録を行うために「実行スケジュール登録画面」へのリンクを選択する
16. アプリケーション運用者は「実行スケジュール登録画面」で「実行環境構築用のジョブネット」の実行を指示する
17. 「実行スケジュール登録画面」はTengineコアに「実行環境構築用のジョブネット」の実行を依頼する実行スケジュール起動イベントを発火する
18. Tengineコアは「実行スケジュール起動イベント」を受信してそのイベントハンドラを実行する
19. 「実行スケジュール起動イベント」のイベントハンドラは、「実行環境構築用のジョブネット」を実行するサーバにSSHで接続を行う
20. 「実行スケジュール起動イベント」のイベントハンドラは、「実行環境構築用のジョブネット」を実行するシェルスクリプトを実行する
21. 「実行環境構築用のジョブネット」を実行するシェルスクリプトは、起動した
