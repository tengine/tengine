ユースケース名:
  アプリケーション運用者が仮想サーバを起動する

背景:
  分散バッチを実行するにはその実行環境をセットアップする必要がある。
  実行環境のセットアップは、
	・構成するサーバを起動する作業
	・設定を行う作業
	・起動したサーバ上で実行する分散バッチをデプロイする作業
	に分けられる。このユースケースでは
	・構成するサーバを起動する作業
	を扱う。

  構成する仮想サーバを起動し設定を行うに当たって、どの物理サーバ上で起動するのかを
  設定できなければならない。これは、例えばHadoopクラスタが動作する仮想サーバ群が
  ネットワーク的に離れた物理サーバ上で動作すると、ネットワーク的に近い場合に比べて
  余計に通信コストがかかってしまうためである。これを解決するために、仮想サーバを起動
  する際に物理サーバ（あるいは同じ物理サーバ）で仮想サーバを起動できるように指定する
  機能が必要である。

概要:
  アプリケーション運用者は、[物理サーバー一覧画面]で物理サーバーを、また[仮想サー
  バー制御画面]で物理サーバ上で起動している仮想サーバを確認した上で、起動する仮想
  サーバのイメージと台数、および利用する物理サーバを指定して起動をTengineに指示する。
  Tengineは仮想サーバ基盤にその内容を指示して、仮想サーバ基盤は仮想サーバの起動を開始する。

事前条件:
  Tengineがセットアップされている。
  Tengineと連携する仮想サーバ基盤がセットアップされている。
  制御対象の物理サーバが起動している。

成功時保証:
  アプリケーション運用者が指定した仮想サーバが全て起動していることを確認できる。

最低保証:
  なし

登場する画面:
  仮想サーバ一覧
  物理サーバー閲覧画面

登場するコンポーネント:
  なし

登場するパッケージ:

登場するドキュメント:

基本コース:
 1. アプリケーション運用者は「仮想サーバ一覧」を開く。<戻り点: 仮想サーバ一覧の表示>
 2. {アプリケーション運用者が仮想サーバの状態を取得する}に遷移する。
 3. {アプリケーション運用者が物理サーバの状態を取得する}に遷移する。
 4. アプリケーション運用者は「仮想サーバ一覧」の「イメージ管理」リンクをクリックして「仮想サーバーイメージ一覧画面」に移動する。<戻り点：仮想サーバーイメージ一覧の確認>
 5. 「仮想サーバーイメージ一覧画面」はTengineに仮想サーバーイメージの情報を問い合わせる。[代替コースG]
 6. Tengineは仮想サーバ基盤に仮想サーバーイメージの情報を問い合わせる。
  * 秋間コメント: Tengineは定期的に仮想サーバイメージの情報を問い合わせてリソースストアに登録／更新するので、ここで直接アクセスする必要はないのでは？
 7. 仮想サーバ基盤はTengineに管理下の仮想サーバーイメージのスペック情報を返却する。
 8. Tengineは管理下の「仮想サーバーイメージ一覧画面」に仮想サーバイメージの情報を返却する。
 9. 「仮想サーバーイメージ情報一覧画面」は仮想サーバイメージの情報を出力する。
10. アプリケーション運用者は「仮想サーバーイメージ情報一覧画面」を確認する。[代替コースA][代替コースF]<戻り点: 仮想サーバーイメージのソート>
11. アプリケーション運用者はどの物理サーバでどのイメージの仮想サーバを何台起動するかを決める。
12. アプリケーション運用者は「仮想サーバ一覧」から、仮想サーバを起動する対象の物理サーバの「この物理サーバー上で仮想サーバーを起動ボタン」を押下し、「仮想サーバ起動画面」に遷移する
13. アプリケーション運用者は「仮想サーバー起動画面」から識別子、インスタンスタイプ、起動インスタンス数を入力して「起動ボタン」を押下する[代替コースB][代替コースE]<戻り点:仮想サーバ起動画面表示>
14. Tengineは仮想サーバ基盤にどの物理サーバでどのイメージの仮想サーバを何台起動するのかを指示する。
15. 仮想サーバ基盤は仮想サーバの起動を始めて、要求のあった仮想サーバ群の状態をTengineに報告する。
16. Tengineは仮想サーバ基盤から返却された仮想サーバ群の状態をリソースストアに登録する。
17. Tengineは要求のあった仮想サーバ群の状態を「仮想サーバ一覧」に返却する。
18. 「仮想サーバ一覧」は要求のあった仮想サーバ群の状態を出力する。
19. アプリケーション運用者はすべての仮想サーバが起動し終えるの待つ。<戻り点：仮想サーバの起動確認>[代替コースC][代替コースD]

代替コースA: 仮想サーバ基盤に登録されている仮想サーバイメージが0台である
 ## 利用可能な仮想サーバーイメージが0台のときに画面表示に問題がないことを確認する。
 1. アプリケーション運用者は「仮想サーバーイメージ一覧画面」で確認できる仮想サーバーイメージが0台であることを確認する。
 2. アプリケーション運用者は仮想サーバ基盤に仮想サーバイメージが登録されていないことを確認する。
 3. アプリケーション運用者は仮想サーバ基盤に仮想サーバイメージを登録する。
 4. <戻り点: 仮想サーバ一覧の表示>に遷移する。

代替コースB: 仮想サーバ基盤で管理している物理サーバに余力がなく、起動可能数が0である
 1. アプリケーション運用者は「仮想サーバ起動画面」で起動可能数が0であることを確認する。
 2. アプリケーション運用者は「仮想サーバ一覧」で不要な仮想サーバが起動していることを確認する。
 3. {アプリケーション運用者が仮想サーバを停止する}に遷移する
 4. <戻り点:仮想サーバ起動画面表示>に遷移する

代替コースC: 仮想サーバーの起動が完了しない（Tengineリソースウォッチャプロセスが落ちている）
 # 定期的にプロバイダの管理下にあるリソースの状態を問い合わせるTengineリソースウォッチャプロセスが停止している場合、
 # サーバーの状態は仮想サーバーの状態は更新されない
 1. アプリケーション運用者はコアサーバでTengineリソースウォッチャのログを確認する
 2. アプリケーション運用者はコアサーバでTengineリソースウォッチャのログを元に問題を取り除く
 3. アプリケーション運用者はコアサーバでTengineリソースウォッチャのプロセスを起動する
 4. アプリケーション運用者はコアサーバでTengineリソースウォッチャのプロセスが起動していることを確認する
 5. <戻り点：仮想サーバの起動確認>に遷移する

代替コースD: 仮想サーバーの状態が変わらない（仮想サーバ基盤が落ちている）
 1. アプリケーション運用者はコアサーバでTengineリソースウォッチャのログを確認する。
 2. アプリケーション運用者はコアサーバでTengineリソースウォッチャのログから、仮想サーバ基盤の接続に問題があることを確認する。
 3. アプリケーション運用者は仮想基盤サーバで仮想サーバ基盤のログを確認する。
 4. アプリケーション運用者は仮想基盤サーバで仮想サーバ基盤のログを元に問題を取り除く。
 5. アプリケーション運用者は仮想基盤サーバで仮想サーバ基盤を起動する。
 6. アプリケーション運用者は仮想基盤サーバで仮想サーバ基盤が起動していることを確認する。
 7. アプリケーション運用者はコアサーバでTengineリソースウォッチャのプロセスが起動していることを確認する
 8. <戻り点：仮想サーバの停止確認>に遷移する

代替コースE: 仮想サーバ基盤に起動指示を投げたが、他のユーザーも仮想サーバの起動を行なっていたため、物理サーバの余力がなくなった場合
 1. アプリケーション運用者は「仮想サーバー起動画面」から識別子、インスタンスタイプ、起動インスタンス数を入力する。
 2. 他のアプリケーション運用者が仮想サーバーを起動し、物理サーバーの余力を使い切る。
 3. アプリケーション運用者は「仮想サーバー起動画面」から「起動ボタン」を押下する。
 4. Tengineは仮想サーバ基盤にどの物理サーバでどのイメージの仮想サーバを何台起動するのかを指示する。
 5. 仮想サーバ基盤は物理サーバに余力がないためにエラーのレスポンスをTengineに返却する。
 6. Tengineは「仮想サーバー起動画面」にエラーメッセージを返却する。
 7. アプリケーション運用者は「仮想サーバ起動画面」に「仮想サーバの起動に失敗しました」のメッセージが表示されることを確認する。

代替コースF: 仮想サーバイメージ一覧をソートしてページ移動を行う 
 1. アプリケーション運用者は「仮想サーバーイメージ情報一覧画面」で「イメージID」をクリックしてソートする。
 2. Tengineは仮想サーバ基盤にイメージIDでソートした仮想サーバーイメージの一覧を要求する。
 3. 仮想サーバ基盤はTengineにイメージIDでソート済みの仮想サーバーイメージ一覧を返却する。
 4. Tengineは「仮想サーバーイメージ一覧画面」にイメージIDでソート済みの仮想サーバーイメージ一覧を返却する。
 5. アプリケーション運用者は「仮想サーバーイメージ一覧画面」がソートされていることを確認する。
 6. アプリケーション運用者は「仮想サーバーイメージ一覧画面」で「次へ」をクリックする。
 7. Tengineは仮想サーバ基盤にイメージIDでソートした仮想サーバーイメージの2ページめの一覧を要求する。
 8. 仮想サーバ基盤はTengineにイメージIDでソート済みの仮想サーバーイメージの2ページ目の一覧を返却する。
 9. Tengineは「仮想サーバーイメージ一覧画面」にイメージIDでソート済みの仮想サーバーイメージの2ページ目の一覧を返却する。
10. アプリケーション運用者は「仮想サーバーイメージ一覧画面」の2ページ目が表示され、かつソートされていることを確認する。
11. <戻り点: 仮想サーバーイメージのソート>に遷移する。

代替コースG: 仮想サーバイメージ一覧画面に仮想サーバーイメージが表示されない（仮想サーバ基盤が落ちている 
 1. アプリケーション運用者は「仮想サーバ一覧」の「イメージ管理」リンクをクリックして「仮想サーバーイメージ一覧画面」に移動する。[代替コースG]
 2. 「仮想サーバーイメージ一覧画面」はTengineに仮想サーバーイメージの情報を問い合わせる。
 3. Tengineは仮想サーバ基盤に仮想サーバーイメージの情報を問い合わせる。
 4. 仮想サーバ基盤からTengineへの返却が行われない。
 5. Tengineは「仮想サーバーイメージ一覧画面」にエラーメッセージを返却する。
 6. 「仮想サーバーイメージ一覧画面」は「仮想サーバーイメージの情報が取得できませんでした」とエラーメッセージを表示する。
 7. [代替コースD]1-7の作業を実施する。
 8. <戻り点：仮想サーバーイメージ一覧の確認>に遷移する。

# 代替コース: 「仮想サーバー起動画面」で指定した仮想サーバが一台も起動しない
# 代替コース: 「仮想サーバー起動画面」で指定した台数より少ない台数の仮想サーバが起動した
# 代替コース: 「仮想サーバー起動画面」で指定した台数より多い台数の仮想サーバが起動した
# 代替コース: 「仮想サーバー起動画面」で指定した物理サーバとは異なる物理サーバから仮想サーバが起動した
# 代替コース: 「仮想サーバー起動画面」で指定したイメージとは異なるイメージ名が画面に表示された
# 代替コース: 仮想サーバーの情報が一部取得できない（IPアドレス、ステータスを想定）
# 代替コース: 仮想サーバーの起動が完了しない（仮想サーバー基盤の情報が更新されない／仮想サーバーが指示なく停止する）
