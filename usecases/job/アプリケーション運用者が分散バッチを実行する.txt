ユースケース名:
  アプリケーション運用者が分散バッチを実行する

背景:
  分散バッチを実行する方法としては、決まった時間に実行する方法や、ある条件が揃ったら実行される方法など
  いくつか考えられるが、このユースケースでは、手動でジョブネットを起動することによって実行する方法を扱う。

概要:
  アプリケーション運用者は、分散バッチの実行環境が整った後、分散バッチ実行用のジョブネットを
  手動で起動することによって、分散バッチを実行する。
  代替ケースがとても多いため、分かりづらい記述になってしまっている。そのため、DSLの実行・再実行の一部と異常系は直接featureに記載する。

事前条件:
  分散バッチ実行環境の構築が完了している

成功時保証:
  アプリケーション運用者が分散バッチの実行が完了したことを確認できる

最低保証:
  なし

登場する画面:
  テンプレートジョブ一覧
  ジョブネット実行設定
  実行ジョブ一覧

登場するコンポーネント:
  分散バッチ実行用のジョブネット # Asakusaが生成したDSLをどうやって登録するか？

登場するパッケージ:

登場するドキュメント:

基本コース:
 1. アプリケーション運用者は「テンプレートジョブ一覧」画面を開く
 2. 「テンプレートジョブ一覧」画面は登録されているジョブネットの一覧を表示する
 3. アプリケーション運用者は「テンプレートジョブ一覧」画面で「分散バッチ実行用のジョブネット」の実行の指示を行うために「ジョブネット実行設定」画面へのリンクを選択する
 4. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する [代替コースB, 代替コースC, 代替コースNP, NF,NS NA , NC]
 5. 「ジョブネット実行設定」画面は「分散バッチ実行用のジョブネット」の実行をTengineコアに指示する <戻り点: ジョブの実行開始>
 6. Tengineコアは「分散バッチ実行用のジョブネット」を実行する
 7. 「分散バッチ実行用のジョブネット」は分散バッチを実行する <戻り点: ジョブ実行中>
 8. 「分散バッチ実行用のジョブネット」は実行が終了したことをTengineコアに伝える [代替コースATS,代替コースATH,AFS]
 9. Tengineコアは「分散バッチ実行用のジョブネット」を終了する <戻り点: ジョブの終了>
10. アプリケーション運用者は「実行ジョブ一覧」画面を開く
11. 「実行ジョブ一覧」画面は「分散バッチ実行用のジョブネット」の実行が終了したことを出力する
12. アプリケーション運用者は「分散バッチ実行用のジョブネット」の実行が正常に終了したことを「実行ジョブ一覧」画面で確認する [代替コースAF,代替コースAR]
13. ユースケースは終了する

代替コースNS: ジョブを実行するサーバが見つからなかった
1. アプリケーション運用者は「実行ジョブ一覧」画面を開き、実行したジョブが異常終了していることを確認する
2. アプリケーション運用者は「イベント通知」画面を開き、異常終了した原因がサーバが見つからなかったためと確認する
3. アプリケーション運用者はジョブを実行するサーバを起動する[代替コースRS]
4. <戻り点: ジョブの実行開始>に遷移する

代替コースRI: ジョブネット定義に記述されていたインスタンス名が間違えていたいた
1. アプリケーション運用者は「実行ジョブ一覧」画面を開き、実行したジョブが異常終了していることを確認する
2. アプリケーション運用者は「イベント通知」画面を開き、異常終了した原因がジョブネットで指定されたジョブ実行環境が本来あるべきものと違ったためと確認する
3. アプリケーション運用者はアプリケーション開発者に修正を依頼する
4. ユースケースは終了する

代替コースNA:ジョブを実行するサーバの認証情報が間違えていた
1. アプリケーション運用者は「実行ジョブ一覧」画面を開き、実行したジョブが異常終了していることを確認する
2. アプリケーション運用者は「イベント通知」画面を開き、異常終了した原因が認証情報が間違えていたためと確認する
3. アプリケーション運用者は「認証情報設定」画面を開き、認証情報を修正する [代替コースRA]
4. <戻り点: ジョブの実行開始>に遷移する

代替コースRA:別のジョブを実行するサーバが指定されていた
1. アプリケーション運用者は「実行ジョブ一覧」画面を開き、実行したジョブが異常終了していることを確認する
2. アプリケーション運用者は「イベント通知」画面を開き、異常終了した原因がジョブネットで指定された認証情報が別のサーバのものだったためと確認する
3. アプリケーション運用者はアプリケーション開発者に修正を依頼する
4. ユースケースは終了する

代替コースNI:ジョブプロセスウォッチャがインストールせていなかった
1. アプリケーション運用者は「実行ジョブ一覧」画面を開き、実行したジョブが異常終了していることを確認する
2. アプリケーション運用者は「イベント通知」画面を開き、異常終了した原因がジョブプロセスウォッチャインストールされていなかったためと確認する
3. アプリケーション運用者はジョブ実行環境へログインし、ジョブプロセスウォッチャをインストールする
4. <戻り点: ジョブの実行開始>に遷移する

代替コースNF:スクリプトが見つからなかった
1. アプリケーション運用者は「実行ジョブ一覧」画面を開き、実行したジョブが異常終了していることを確認する
2. アプリケーション運用者は「イベント通知」画面を開き、異常終了した原因が実行するスクリプトが見つからなかったためと確認する
3. アプリケーション運用者はジョブ実行環境へログインし、スクリプトのセットアップをする
4. <戻り点: ジョブの実行開始>に遷移する

代替コースNP:スクリプトに実行権限がなかった
1. アプリケーション運用者は「実行ジョブ一覧」画面を開き、実行したジョブが異常終了していることを確認する
2. アプリケーション運用者は「イベント通知」画面を開き、異常終了した原因が実行するスクリプトに実行権限がなかったためと確認する
3. アプリケーション運用者はジョブ実行環境へログインし、スクリプトに実行権限を追加する
4. <戻り点: ジョブの実行開始>に遷移する

代替コースATS: 実行を指示したルートジョブネット・ジョブネット・ジョブの実行時間が警告送信時間を超えた
1. Tengineコアはアプリケーション運用者に、実行を指示したルートジョブネット・ジョブネット・ジョブの実行時間が警告送信時間を超えたことを通知する
2. アプリケーション運用者は実行を指示したルートジョブネット・ジョブネット・ジョブの実行時間が警告送信時間を超えた通知を受ける
3. アプリケーション運用者は通知内容を判断して、問題がないので処理を継続する [代替コースAFS]
4. <戻り点: ジョブの終了>に遷移する

代替コースAFS: ジョブが異常に長く処理を続けているので強制停止する
1. アプリケーション運用者はルートジョブネット全体を強制停止するために、「実行ジョブ一覧」画面を開く
2. アプリケーション運用者はName:jobnet0004の強制停止リンクを選択する [代替コースAFSP]
3. <戻り点: ジョブの終了>に遷移する

代替コースAFSP: 複数のジョブが実行されているが、一部の異常なジョブ・ジョブネットのみを強制停止する
1. アプリケーション運用者は個別のジョブ・ジョブネットを強制停止するために、「ジョブネット監視」画面へ遷移するName:jobnet0004の監視リンクを選択する
2. アプリケーション運用者は、異常なジョブ・ジョブネットの強制停止リンクを選択する
3. <戻り点: ジョブ実行中>に遷移する

代替コースATH: 誤ったジョブを実行してしまった為、強制停止する
1. アプリケーション運用者はルートジョブネット全体を強制停止するために、「実行ジョブ一覧」画面を開く
2. アプリケーション運用者はName:jobnet0004の強制停止リンクを選択する
3. <戻り点: ジョブの終了>に遷移する

代替コースAF: 「分散バッチ実行用のジョブネット」が異常終了していた
1. アプリケーション運用者は「分散バッチ実行用のジョブネット」の実行が異常終了したことを「実行ジョブ一覧」画面で確認する
2. ユースケースは終了する [代替コースAFR]

代替コースAFR: 異常終了した「分散バッチ実行用のルートジョブネット」を再実行する
1. アプリケーション運用者は、失敗したルートジョブネットを再実行するために、「実行ジョブ一覧」から「分散バッチ実行用のジョブネット」の「ジョブネット監視」画面へのリンクを選択する
2. アプリケーション運用者は、ジョブ・ジョブネットを起点として再実行しようとする [代替コースAFRP]
3. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が失敗したポイント「job2」を再実行するために、「job002」の「ジョブネット実行設定」画面へのリンクである再実行を選択する [代替コース]
4. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
5. <戻り点: ジョブの実行開始>に遷移する

代替コースAFR_1: jobnet 004のjob2が失敗しており、job1から再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job1」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFR_2: jobnet 004のjob2とjob3が失敗しており、job1から再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job1」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFR_3: jobnet 004のjob2とjob3が失敗しており、job1から再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job1」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFR_4: jobnet 004のjob2が失敗しており、job3から再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFR_5: jobnet 004のjob1が失敗しており、job2が成功しており、job3から再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFR_6: jobnet 004のjob1が失敗しており、job2が成功しており、job3から再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFR_7: jobnet 004のfinally_job2とfinally_job3が失敗しており、finally_job3から再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「finally_job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFR_8: jobnet 004のjob2とjob3,finally_job3が失敗しており、finally_job3から再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「finally_job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する


代替コースAFRP: 異常終了した「分散バッチ実行用のジョブネット」のジョブ・ジョブネットのみ再実行しようとする
1. アプリケーション運用者は、失敗したジョブ・ジョブネットを再実行する
2. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が失敗したポイント「job2」を再実行するために、「job002」の「ジョブネット実行設定」画面へのリンクである再実行を選択する [代替コース]
3. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
4. <戻り点: ジョブの実行開始>に遷移する

代替コースAFRP_1: jobnet 004のjob2が失敗しており、job1を再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job1」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFRP_2: jobnet 004のjob2とjob3が失敗しており、job1を再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job1」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFRP_3: jobnet 004のjob2とjob3が失敗しており、job1を再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job1」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFRP_4: jobnet 004のjob2が失敗しており、job3を再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFRP_5: jobnet 004のjob1が失敗しており、job2が成功しており、job3を再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFRP_6: jobnet 004のjob1が失敗しており、job2が成功しており、job3を再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFRP_7: jobnet 004のfinally_job2とfinally_job3が失敗しており、finally_job3を再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「finally_job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する

代替コースAFRP_8: jobnet 004のjob2とjob3,finally_job3が失敗しており、finally_job3を再実行する
1. アプリケーション運用者は、「ジョブネット監視」画面からジョブネットjobnet0004が「finally_job3」から再実行するために、「jobnet004」の「ジョブネット実行設定」画面へのリンクである再実行を選択する
2. アプリケーション運用者は「ジョブネット実行設定」画面で「分散バッチ実行用のジョブネット」の実行を指示する
3. <戻り点: ジョブの実行開始>に遷移する


代替コースB: 二階層のジョブDSLを利用する
#代替コースAFRやAFRPのように再実行のパターン毎に代替コースを作成していきます。
#ただ、非常に冗長になるのでfeatureに記載します。
#二階層のジョブDSLと一階層でのユースケースの違いは、ジョブネットを利用を利用しているかどうかです。

代替コースC: 三階層のジョブDSLを利用する
#代替コースAFRやAFRPのように再実行のパターン毎に代替コースを作成していきます。
#非常に冗長になるのでfeatureに記載します
#三階層と、二階層、一階層とのユースケースの違いは、再実行地点から見て、上と下の階層が存在することです

