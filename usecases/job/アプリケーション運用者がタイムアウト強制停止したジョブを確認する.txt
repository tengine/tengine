ユースケース名:
  アプリケーション開発者がタイムアウト強制停止したジョブを確認する

背景:
  アプリケーション運用者が実行しているバッチを画面を用いて問題が発生した、またはしそうなバッチを監視するのは運用の負荷が高い。
  その解決方法の一つとして、 実行するバッチに実行時間を設定し、実行時間が過ぎた場合、アプリケーション運用者に通知が届いたり、
  自動的にバッチを強制停止する仕組みを提供する必要がある。

概要:
  アプリケーション運用者に設定に応じて実行時間が以上に長いジョブを伝え、強制停止を行う。タイムアウト強制停止が行われたジョブを確認し、
  原因を調査する。アプリケーション運用者が手動で強制停止を行うわけではないので、様々な状況でジョブのタイムアウト強制停止が起こりうる。
  アプリケーション運用者は、実行ジョブ一覧画面からタイムアウト強制停止したジョブを監視し、対応を行う。

事前条件:
  DBプロセスが起動している
  キューのプロセスが起動している
  Tengineコアが起動している
  Tengineコンソールが起動している

成功時保証:
  アプリケーション開発者にバッチが異常な時間動作していることを伝える

最低保証:
  なし

登場するコンポーネント:
  イベント管理画面
  ジョブ管理画面

登場するパッケージ:
  Tengineコア
  Tengineコンソール
  Tengineジョブプロセスウォッチドッグ  
  
参照するドキュメント:
  Getting Started
  アプリケーション開発者向けTengineマニュアル
  アプリケーション運用者向けTengineマニュアル

= running =
== retry1 ==

#実行中のジョブ一つで停止
代替コースR1_2:retry1のj1を実行中にルートジョブネットをタイムアウト強制停止
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj1が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj1のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はj1が「タイムアウト強制停止済み」となっていることを確認する
. アプリケーション運用者はj2,j3,j4,jn0004_fが「準備中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する


 #実行中のジョブが２つで２つともタイムアウト強制停止
代替コースR1_8:retry1のj2,j3を実行中にルートジョブネットをタイムアウト強制停止
アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj1が「正常終了」になっていることを確認する
. アプリケーション運用者はj2,j3が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj2,j3のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はj2,j3が「タイムアウト強制停止済み」になっていることを確認する
. アプリケーション運用者はj4が「準備中」になっていることを確認する
. アプリケーション運用者はjn0004_fが「準備中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する


#実行中のジョブが２つで片方を強制停止_片方強制停止時にもう片方が動いている_もう片方が「正常終了」している
代替コースR1_3:retry1のj2を実行中にタイムアウト強制停止_もう片方が「正常終了」している
. アプリケーション運用者は「実行ジョブ一覧」画面を開き、タイムアウト強制停止を行ったルートジョブネットが「強制停止中」になっていることを確認する
. アプリケーション運用者は「実行ジョブ一覧」画面を開き強制停止したルートジョブネットの監視リンクをクリックし、「ジョブネット監視」画面を開く
. アプリケーション運用者はj1,j3が「正常終了」になっていることを確認する
. アプリケーション運用者はj2が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj2のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はj2が「タイムアウト強制停止済み」となっていることを確認する
. アプリケーション運用者はj4,jn0004_fが「準備中」になっていることを確認する
. アプリケーション運用者は「実行ジョブ一覧」画面を開き、強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する

#実行中のジョブが２つで片方を強制停止_片方強制停止時にもう片方が動いている_もう片方が「エラー終了」している
代替コースR1_4:retry1のj2を実行中にタイムアウト強制停止_もう片方が「エラー終了」している
. アプリケーション運用者は「実行ジョブ一覧」画面を開き、タイムアウト強制停止を行ったルートジョブネットが「強制停止中」になっていることを確認する
. アプリケーション運用者は「実行ジョブ一覧」画面を開き強制停止したルートジョブネットの監視リンクをクリックし、「ジョブネット監視」画面を開く
. アプリケーション運用者はj1が「正常終了」になっていることを確認する
. アプリケーション運用者はj3が「エラー終了」になっていることを確認する
. アプリケーション運用者はj2が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj2の強制停止が終わるまで待つ
. アプリケーション運用者はj2が「タイムアウト強制停止済み」となっていることを確認する
. アプリケーション運用者はj4,jn0004_fが「準備中」になっていることを確認する
. アプリケーション運用者は「実行ジョブ一覧」画面を開き、強制停止を行ったルートジョブネットが「タイムアウト強制停止済」になっていることを確認する

#finally
代替コースR1_11:retry1のjn0004_fを実行中にルートジョブネットをタイムアウト強制停止
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj1,j2,j3,j4が「正常終了」となっていることを確認する
. アプリケーション運用者はjn0004_fが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はjn0004_fのタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はjn0004_fが「タイムアウト強制停止済み」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する

--retry2--

#ジョブネットの停止_ルートジョブネット内のジョブネット内で稼働中のジョブが一つ
代替コースR2_7:retry2のj2,j41を実行中にタイムアウト強制停止
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj2,jn4,j41が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj2,j41のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はj2がjn4,j41が「タイムアウト強制停止済み」となっていることを確認する
. アプリケーション運用者はj42,j43,j44,j4,jn0005_fが「準備中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する

#ジョブネットの停止_ルートジョブネット内のジョブネット内で稼働中のジョブが2つ
代替コースR2_8:retry2のj2,j42,j43を実行中にタイムアウト強制停止
アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj2,jn4が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj41が「正常終了」になっていることを確認する
. アプリケーション運用者はj42,j43が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj2,j42,j43のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はj2,jn4,j42,j43が「タイムアウト強制停止済み」となっていることを確認する
. アプリケーション運用者はj44,j4,jn0005_fが「準備中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する

#ジョブネットの停止_ルートジョブネット内のジョブネット内で稼働中のジョブが1つ_片方が正常終了している
代替コースR2_8:retry2のj2,j42を実行中にタイムアウト強制停止_j43が正常終了
アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj2,jn4が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj41,j43が「正常終了」になっていることを確認する
. アプリケーション運用者はj42が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj2,j42のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はj2,jn4,j42が「タイムアウト強制停止済み」となっていることを確認する
. アプリケーション運用者はj44,j4,jn0005_fが「準備中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する

#ジョブネットの停止_ルートジョブネット内のジョブネット内で稼働中のジョブが1つ_片方がエラー終了している
代替コースR2_8:retry2のj2,j42を実行中にタイムアウト強制停止_j43がエラー終了
アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj2,jn4が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj41が「正常終了」になっていることを確認する
. アプリケーション運用者はj43が「エラー終了」になっていることを確認する
. アプリケーション運用者はj42が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj2,j42のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はj2,jn4,j42が「タイムアウト強制停止済み」となっていることを確認する
. アプリケーション運用者はj44,j4,jn0005_fが「準備中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する

#ルートジョブネット内のジョブネットのfinally実行中にタイムアウト強制停止_ルートジョブネット
代替コースR2_10:retry2のjn4_fを実行中にルートジョブネットをタイムアウト強制停止
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj2,jn4が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj41,j42,j43,j44が「正常終了」になっていることを確認する
. アプリケーション運用者はjn4_fが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj2,jn4_fのタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はjn4_fが「タイムアウト強制停止済み」となっていることを確認する
. アプリケーション運用者はj44,j4,jn0005_fが「準備中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する

#finally内finally実行中にタイムアウト強制停止_ルートジョブネット指定
代替コースR2_13:retry2のjn0005_fif実行中にルートジョブネットをタイムアウト強制停止する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj2,jn4,j41,j42,j43,j44,jn4_f,j44,j4,jn0005_f1,jn0005_f2が「正常終了」になっていることを確認する
. アプリケーション運用者はjn0005_fifが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はjn0005_fが「準備中」になっていることを確認する
. アプリケーション運用者はjn0005_fifのタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はjn0005_fifが「タイムアウト強制停止済み」になること
. アプリケーション運用者はjn0005_fjnが「タイムアウト強制停止済み」になること
. アプリケーション運用者はjn0005が「タイムアウト強制停止済み」になること
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する


--retry3--

#ジョブネットの中のジョブネット内にあるジョブをルートジョブネットを指定してタイムアウト強制停止
代替コースR3_4:retry2のjn111を実行中にルートジョブネットをタイムアウト強制停止
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はjn1,jn11が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はjn111のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はjn1,jn11,jn111が「タイムアウト強制停止済み」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する

= starting =

== retry1 ==
#ジョブの状態が「開始中」でルートジョブネットを指定してジョブが実行されている
代替コースR1_2: j1の状態が「開始中」にルートジョブネットのタイムアウト強制停止を行う
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「実行中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. アプリケーション運用者はj1が「実行中」になっていることを確認する
. アプリケーション運用者はj1の「タイムアウト強制停止中」になるまで待つ
. アプリケーション運用者はj1が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者はj1のタイムアウト強制停止が終わるまで待つ
. アプリケーション運用者はj1が「タイムアウト強制停止済み」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する


== retry3 ==

#ジョブネットの中のジョブネット内にあるジョブをルートジョブネットを指定してタイムアウト強制停止
代替コースR3_8:retry2のj111を「開始中」にルートジョブネットをタイムアウト強制停止
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「実行中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開きタイムアウト強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開
. アプリケーション運用者はjn1,jn11,jn111が「実行中」になっていることを確認する
. アプリケーション運用者はj111のタイムアウト強制停止中になるまで待つ
. アプリケーション運用者はjn1,jn11,jn111が「タイムアウト強制停止中」になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き、タイムアウト強制停止を行ったルートジョブネットが「タイムアウト強制停止済み」になっていることを確認する
