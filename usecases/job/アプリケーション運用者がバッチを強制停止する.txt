ユースケース名:
  アプリケーション運用者が分散バッチを強制停止する

背景:
  分散バッチを強制停止する理由としては、ジョブが異常に長い時間動作している場合や、実行するバッチを間違えた場合、投入するデータを間違えた場合等がある。
  強制停止するタイミングは、アプリケーションによって異なるため、バッチがどのような状態でも強制停止をすることができる。

概要:
  アプリケーション運用者は、分散バッチの実行環境が整った後、分散バッチ実行用のジョブネット、
  及びジョブを手動で強制停止することによって、分散バッチを強制停止する。
  このユースケースは{アプリケーション運用者がバッチを実行する}から強制停止に関する代替コースを抜き出したものである。

事前条件:
  分散バッチ実行環境の構築が完了している

成功時保証:
  アプリケーション運用者が分散バッチの実行が完了したことを確認できる

最低保証:
  なし

登場する画面:
  テンプレートジョブ一覧画面
  ジョブネット実行設定画面
  実行ジョブ一覧画面

登場するコンポーネント:
  分散バッチ実行用のジョブネット # Asakusaが生成したDSLをどうやって登録するか？

登場するパッケージ:

登場するドキュメント:

= runningからdying =

#fork前、ルートジョブネットの最初
代替コースR1Job1:retry1のj1を実行中にj1を強制停止
 実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 j1が強制停止中になっていることを確認する
 j1の強制停止が終わるまで待つ
. j1が強制停止済みとなっていることを確認する
. j2,j3,j4が準備中になっていることを確認する
. jn0004_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#実行中のジョブ一つで停止
代替コースR1Job1:retry1のj1を実行中にルートジョブネットを強制停止
実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 j1が強制停止中になっていることを確認する
 j1の強制停止が終わるまで待つ
. j1が強制停止済みとなっていることを確認する
. j2,j3,j4が準備中になっていることを確認する
. jn0004_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#実行中のジョブが２つで片方を強制停止
代替コースR1Job1:retry1のj2,j3を実行中にj2を強制停止
実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. j1が正常終了になっていることを確認する
. j3が実行中になっていることを確認する
. j2が強制停止中になっていることを確認する
 j2の強制停止が終わるまで待つ
. j2が強制停止済みとなっていることを確認する
  j3が正常終了になっていることを確認する
  j4が準備中になっていることを確認する
. jn0004_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#実行中のジョブが２つで２つとも強制停止
代替コースR1Job1:retry1のj2,j3を実行中にルートジョブネットを強制停止
実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. j1が正常終了になっていることを確認する
. j2が強制停止中になっていることを確認する
. j3が強制停止中になっていることを確認する
 j2,j3の強制停止が終わるまで待つ
. j2が強制停止済みとなっていることを確認する
  j3が強制停止済みになっていることを確認する
  j4が準備中になっていることを確認する
. jn0004_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#join後、ルートジョブネットの最後
代替コースR1Job1:retry1のj4を実行中にj4を強制停止
 実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. j1が正常終了になっていることを確認する
. j2が正常終了になっていることを確認する
. j3が正常終了になっていることを確認する
. j4が強制停止中となっていることを確認する
  j4の強制停止が終わるまで待つ
  j4が強制停止済みになっていることを確認する
. jn0004_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#finally_単一指定
代替コースR1Job1:retry1のjn0004_fを実行中にjn0004_fを強制停止
 実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. j1が正常終了になっていることを確認する
. j2が正常終了になっていることを確認する
. j3が正常終了になっていることを確認する
. j4が正常終了となっていることを確認する
. jn0004_fが強制停止中になっていることを確認する
  jn0004_fの強制停止が終わるまで待つ
. jn0004_fが強制停止済みになっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#finally_ルートジョブネット指定
代替コースR1Job1:retry1のjn0004_fを実行中にルートジョブネットを強制停止
 実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
. j1が正常終了になっていることを確認する
. j2が正常終了になっていることを確認する
. j3が正常終了になっていることを確認する
. j4が正常終了となっていることを確認する
. jn0004_fが強制停止中になっていることを確認する
  jn0004_fの強制停止が終わるまで待つ
. jn0004_fが強制停止済みになっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する


== retry2 ==

#ジョブネットの停止_単一指定_ジョブ
代替コースR1Job1:retry2のj2,j41を実行中にj41を強制停止
 実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 jn4が強制停止中になっていることを確認する
 j41が強制停止中になっていることを確認する
 j41の強制停止が終わるまで待つ
. jn4が強制停止済みとなっていることを確認する
. j41が強制停止済みとなっていることを確認する
. j42,j43,j44,j4が準備中になっていることを確認する
. j2が正常終了していることを確認する
. jn0005_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#ジョブネットの停止_単一指定_ジョブネット指定_稼働中のジョブが一つ
代替コースR1Job1:retry2のj2,j41を実行中にjn4を強制停止
 実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 jn4が強制停止中になっていることを確認する
 j41が強制停止中になっていることを確認する
 j41の強制停止が終わるまで待つ
. jn4が強制停止済みとなっていることを確認する
. j41が強制停止済みとなっていることを確認する
. j42,j43,j44,j4が準備中になっていることを確認する
. j2が正常終了していることを確認する
. jn0005_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#ジョブネットの停止_単一指定_ジョブネット指定_稼働中のジョブが2つ
代替コースR1Job1:retry2のj2,j42,j43を実行中にjn4を強制停止
 実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 jn4が強制停止中になっていることを確認する
 j41が正常終了になっていることを確認する
 j42が強制停止中になっていることを確認する
 j43が強制停止中になっていることを確認する
 j42の強制停止が終わるまで待つ
 j43の強制停止が終わるまで待つ
. jn4が強制停止済みとなっていることを確認する
. j42が強制停止済みとなっていることを確認する
. j43が強制停止済みとなっていることを確認する
. j44,j4が準備中になっていることを確認する
. j2が正常終了していることを確認する
. jn0005_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する


#ジョブネットの停止_ルートジョブネット指定_稼働中のジョブが一つ
代替コースR1Job1:retry2のj2,j41を実行中にルートジョブネットを強制停止
 実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 j2が強制停止中になっていることを確認する
 jn4が強制停止中になっていることを確認する
 j41が強制停止中になっていることを確認する
 j2,j41の強制停止が終わるまで待つ
. j2が強制停止済みとなていることを確認する
. jn4が強制停止済みとなっていることを確認する
. j41が強制停止済みとなっていることを確認する
. j42,j43,j44,j4が準備中になっていることを確認する
. jn0005_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#ジョブネットの停止_ルートジョブネット指定_ジョブネット指定_稼働中のジョブが2つ
代替コースR1Job1:retry2のj2,j42,j43を実行中にjn4を強制停止
実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 j2が強制停止中になっていることを確認する
 jn4が強制停止中になっていることを確認する
 j41が正常終了になっていることを確認する
 j42が強制停止中になっていることを確認する
 j43が強制停止中になっていることを確認する
 j2,j42,j43の強制停止が終わるまで待つ
. j2が強制停止済みとなっていることを確認する
. jn4が強制停止済みとなっていることを確認する
. j42が強制停止済みとなっていることを確認する
. j43が強制停止済みとなっていることを確認する
. j44,j4が準備中になっていることを確認する
. jn0005_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#ルートジョブネット内のジョブネットのfinally実行中に強制停止_ジョブネット指定
代替コースR1Job1:retry2のjn4_fを実行中にjn4を強制停止
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 j2が実行中になっていることを確認する
 jn4が強制停止中になっていることを確認する
 j41が正常終了になっていることを確認する
 j42が正常終了になっていることを確認する
 j43が正常終了になっていることを確認する
 j44が正常終了になっていることを確認する
 jn4_fが強制停止中になっていることを確認する
 jn4_fの強制停止が終わるまで待つ
. jn4_fが強制停止済みとなっていることを確認する
. j44,j4が準備中になっていることを確認する
. jn0005_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#ルートジョブネット内のジョブネットのfinally実行中に強制停止_ルートジョブネット
代替コースR1Job1:retry2のjn4_fを実行中にルートジョブネットを強制停止
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 j2が強制停止中になっていることを確認する
 jn4が強制停止中になっていることを確認する
 j41が正常終了になっていることを確認する
 j42が正常終了になっていることを確認する
 j43が正常終了になっていることを確認する
 j44が正常終了になっていることを確認する
 jn4_fが強制停止中になっていることを確認する
 j2,jn4_fの強制停止が終わるまで待つ
. jn4_fが強制停止済みとなっていることを確認する
. j44,j4が準備中になっていることを確認する
. jn0005_fが準備中になっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#finally内finally実行中に強制停止_ジョブネット指定
代替コースR1Job1:retry2のjn0005_fif実行中にjn0005_fjnを強制停止する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 j2が正常終了になっていることを確認する
 jn4が正常終了になっていることを確認する
 j41が正常終了になっていることを確認する
 j42が正常終了になっていることを確認する
 j43が正常終了になっていることを確認する
 j44が正常終了になっていることを確認する
 jn4_fが正常終了になっていることを確認する
. j44が正常終了になっていることを確認する
 j4が正常終了になっていることを確認する
 jn0005_f1が正常終了になっていることを確認する
 jn0005_f2が正常終了になっていることを確認する
 jn0005_fifが強制停止中になっていることを確認する
. jn0005_fが準備中になっていることを確認する
　jn0005_fifの強制停止が終わるまで待つ
 jn0005が強制停止済みになること
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#finally内finally実行中に強制停止_ルートジョブネット指定
代替コースR1Job1:retry2のjn0005_fif実行中にルートジョブネットを強制停止する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 j2が正常終了になっていることを確認する
 jn4が正常終了になっていることを確認する
 j41が正常終了になっていることを確認する
 j42が正常終了になっていることを確認する
 j43が正常終了になっていることを確認する
 j44が正常終了になっていることを確認する
 jn4_fが正常終了になっていることを確認する
. j44が正常終了になっていることを確認する
 j4が正常終了になっていることを確認する
 jn0005_f1が正常終了になっていることを確認する
 jn0005_f2が正常終了になっていることを確認する
 jn0005_fifが強制停止中になっていることを確認する
. jn0005_fが準備中になっていることを確認する
　jn0005_fifの強制停止が終わるまで待つ
 jn0005が強制停止済みになること
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する


== retry3 ==

#ジョブネットの中のジョブネット内にあるジョブをジョブを指定して強制停止
代替コースR1Job1:retry2のjn111を実行中にjn111を強制停止
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 jn1が強制停止中になっていることを確認する
 jn11が強制停止中になっていることを確認する
 jn111の強制停止が終わるまで待つ
 jn1が強制停止済みになっていることを確認する
 jn11が強制停止済みになっていることを確認する
 jn111が強制停止済みになっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#ジョブネットの中のジョブネット内にあるジョブを1つ上のジョブネットを指定して強制停止
代替コースR1Job1:retry2のjn111を実行中にjn11を強制停止
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 jn1が強制停止中になっていることを確認する
 jn11が強制停止中になっていることを確認する
 jn111の強制停止が終わるまで待つ
 jn1が強制停止済みになっていることを確認する
 jn11が強制停止済みになっていることを確認する
 jn111が強制停止済みになっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#ジョブネットの中のジョブネット内にあるジョブを２つ上のジョブネットを指定して強制停止
代替コースR1Job1:retry2のjn111を実行中にjn1を強制停止
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 jn1が強制停止中になっていることを確認する
 jn11が強制停止中になっていることを確認する
 jn111の強制停止が終わるまで待つ
 jn1が強制停止済みになっていることを確認する
 jn11が強制停止済みになっていることを確認する
 jn111が強制停止済みになっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する

#ジョブネットの中のジョブネット内にあるジョブをルートジョブネットを指定して強制停止
代替コースR1Job1:retry2のjn111を実行中にルートジョブネットを強制停止
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止中になっていることを確認する
. アプリケーション運用者は実行ジョブ一覧画面を開き強制停止したルートジョブネットの監視リンクをクリックし、ジョブネット監視画面を開く
 jn1が強制停止中になっていることを確認する
 jn11が強制停止中になっていることを確認する
 jn111の強制停止が終わるまで待つ
 jn1が強制停止済みになっていることを確認する
 jn11が強制停止済みになっていることを確認する
 jn111が強制停止済みになっていることを確認する
  実行ジョブ一覧画面を開き、強制停止を行ったルートジョブネットが強制停止済みになっていることを確認する


