ユースケース名:
  アプリケーション運用者がジョブネット定義のデプロイを行う

背景:
  アプリケーション開発者はジョブネット定義の作成、変更を行い、SCMサーバへ登録を行う
  その後リリース計画に基づいて、アプリケーション運用者がステージング環境や本番環境へのリリースを行う
  このユースケースは、アプリケーション運用者が各環境へリリースを行う部分を取り扱う


概要:
  アプリケーション運用者がジョブネット定義のデプロイを行い、ジョブネット定義を本番環境やステージング環境に反映する
  ジョブネット定義はGitで管理されており、デプロイ時はGitのリポジトリURLを指定することにより、
  GitからDSLを取得し、Tengineにデプロイされる。
  デプロイは以下の3つの操作で構成されており、それぞれの役割は以下のとおり
   * デプロイのセットアップ  デプロイの準備を行う
   * DSLファイルの更新      DSLファイルの更新を行う
   * Tengineの起動         Tengineコアプロセスの起動を行う


事前条件:
  デプロイに必要な情報が揃っていること
   * アプリケーション名
   * デプロイ対象サーバの情報
     * デプロイ対象サーバーのアドレス
     * デプロイ対象サーバーのSSHポート番号
     * デプロイ対象サーバにSSHログインするときのユーザー名
     * デプロイ対象サーバにSSHログインするときのパスワード
     * デプロイパス
   * SCMサーバの情報
     * SCMの種類(Git)
     * リポジトリのURL
     * ブランチ名
  デプロイ先のすべてのサーバが起動していること
  デプロイ先のすべてのサーバに以下のパッケージのインストールが完了していること
   * Tengineコア
   * Tengineジョブ
  デプロイ作業を行う端末にCapistranoがインストールされていること


成功時保証:
  なし


最低保証:
  なし


登場するコンポーネント:



参照するドキュメント:
  運用者向けTengineマニュアル


登場するパッケージ:
  Tengineコア
  Tengineジョブ


基本コース:

  1. アプリケーション運用者はデプロイに必要なスクリプトファイル(deploy.rb)を作成する[代替コースA]＜戻り点:スクリプトファイル作成＞

  2. アプリケーション運用者は本番環境に対してデプロイのセットアップを行う(cap production deploy:setup)＜戻り点:セットアップ実施＞
  3. アプリケーション運用者はデプロイのセットアップが成功したことを確認する[代替コースB]

  4. アプリケーション運用者は本番環境に対してDSLファイルの更新を行う(cap production deploy:update/cap production deploy:bundle)＜戻り点:デプロイの更新実施＞
  5. アプリケーション運用者はジョブネット定義の更新が成功したことを確認する[代替コースC]

  6. アプリケーション運用者は本番環境に対してTengineの起動を行う(cap production deploy:start)
  7. アプリケーション運用者はTengineの起動が成功したことを確認する[代替コースD]

  8. アプリケーション運用者はTengineが正しく稼動していることをコマンド(cap production deploy:status)で確認する[代替コースE]＜戻り点:Tengineの稼動確認＞

  9. ユースケースは終了する


代替コースA: [正常系] ステージング環境に対してデプロイを行う場合

  1. アプリケーション運用者はステージング環境に対してデプロイのセットアップを行う(cap stagind deploy:setup)＜戻り点:セットアップ実施＞
  2. アプリケーション運用者はデプロイのセットアップが成功したことを確認する[代替コースB]

  3. アプリケーション運用者はステージング環境に対してDSLファイルの更新を行う(cap staging deploy:update/cap staging deploy:bundle)＜戻り点:デプロイの更新実施＞
  4. アプリケーション運用者はジョブネット定義の更新が成功したことを確認する[代替コースC]

  5. アプリケーション運用者はステージング環境に対してTengineの起動を行う(cap staging deploy:start)
  6. アプリケーション運用者はTengineの起動が成功したことを確認する[代替コースD]

  7. アプリケーション運用者はTengineが正しく稼動していることをコマンド(cap staging deploy:status)で確認する[代替コースE]＜戻り点:Tengineの稼動確認＞

  8. ユースケースは終了する


代替コースB: [異常系] デプロイのセットアップが失敗した場合(deploy.rbのデプロイサーバーの情報が間違っている)
  1. deploy.rbの内容を確認し、正しく修正する
  2. ＜戻り点:セットアップ実施＞に遷移する


代替コースC: [異常系] デプロイの更新が失敗した場合(deploy.rbのSCMサーバの情報が間違っている)
  1. deploy.rbの内容を確認し、正しく修正する
  2. ＜戻り点:デプロイの更新実施＞に遷移する


代替コースD: [異常系] Tengineサーバの起動に失敗した場合(ジョブネット定義が間違っている)
  1. ジョブネット定義の内容を確認し、修正する
  2. DSLファイルをSCMサーバに更新する
  3. ＜戻り点:デプロイの更新実施＞に遷移する


代替コースE: [異常系] Tengineサーバが正しく稼動していない場合(startして時間が経過していない)
  1. 時間を置いて再度実行する
  2. ＜戻り点:Tengineの稼動確認＞に遷移する


注記:
  なし
